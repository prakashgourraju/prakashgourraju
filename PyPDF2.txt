import PyPDF2

# Open an existing PDF document
pdf_file = open('example.pdf', 'rb')
pdf_reader = PyPDF2.PdfFileReader(pdf_file)

# Create a PDF writer object
pdf_writer = PyPDF2.PdfFileWriter()

# Add each page of the input PDF to the writer object
for page_num in range(pdf_reader.numPages):
    pdf_writer.addPage(pdf_reader.getPage(page_num))

# Retrieve the existing table of contents
toc = pdf_reader.outlines

# Create a new outlines object to store the bookmarks
outlines = PyPDF2.pdf.Outlines()

# Iterate over the existing table of contents and create a corresponding bookmark
for toc_item in toc:
    if isinstance(toc_item, list):
        # If the TOC item is a sublist, iterate over its items
        sublist = PyPDF2.pdf.Outlines()
        for sublist_item in toc_item:
            page_num = pdf_reader.getDestinationPageNumber(sublist_item['/Dest'])[0]
            bookmark = PyPDF2.pdf.OutlineNode(sublist_item['/Title'], page_num)
            sublist.addBookmark(bookmark)
        outlines.addBookmark(PyPDF2.pdf.OutlineNode(toc_item[0]['/Title'], None, None, sublist))
    else:
        page_num = pdf_reader.getDestinationPageNumber(toc_item['/Dest'])[0]
        bookmark = PyPDF2.pdf.OutlineNode(toc_item['/Title'], page_num)
        outlines.addBookmark(bookmark)

# Add the bookmarks to the PDF writer object
pdf_writer.addBookmark(outlines)

# Write the output PDF to a file
output_pdf = open('output.pdf', 'wb')
pdf_writer.write(output_pdf)

# Close the input and output PDF files
pdf_file.close()
output_pdf.close()
