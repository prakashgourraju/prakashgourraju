import PyPDF4

# Open the PDF file
pdf_file = open('example.pdf', 'rb')

# Create a PDF reader object
pdf_reader = PyPDF4.PdfFileReader(pdf_file)

# Create a PDF writer object
pdf_writer = PyPDF4.PdfFileWriter()

# Add a table of contents to the PDF
toc = PyPDF4.generic.Outlines()

# Create a bookmark for the table of contents
toc_title = PyPDF4.generic.TextStringObject('Table of Contents')
toc_dest = pdf_writer.addBookmark(toc_title, parent=None)

# Iterate over each page in the PDF
for page_num in range(pdf_reader.getNumPages()):
    # Get the page object
    page_obj = pdf_reader.getPage(page_num)

    # Add the page to the PDF writer object
    pdf_writer.addPage(page_obj)

    # Get the page's table of contents entry (e.g. "Chapter 1")
    toc_entry = page_obj.extractText().splitlines()[0]

    # Create a bookmark for the page's table of contents entry
    toc_title = PyPDF4.generic.TextStringObject(toc_entry)
    toc_dest = pdf_writer.addBookmark(toc_title, parent=toc_dest, color=None, fit='/FitH', zoom=None)

# Write the output PDF file
output_file = open('example_with_toc.pdf', 'wb')
pdf_writer.write(output_file)

# Close the input and output files
pdf_file.close()
output_file.close()
